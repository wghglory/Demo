<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script type="text/javascript">
        window.onload = function () {
           
            //1加载省份信息.第二个参数表示要加载省还是城市
            initProvinceOrCity(0, 'sProvince');

            //为sProvince注册一个【选择项改变事件】
            document.getElementById('sProvince').onchange = function () {
                //1.获取当前用户选择的省份的Id
                var pid = this.value;

                //重新加载之前要清空
                //document.getElementById('sCity').innerHTML = '';
                var citySelect = document.getElementById('sCity');
                while (citySelect.firstChild) {
                    citySelect.removeChild(citySelect.firstChild);
                }

                //2.根据该省份Id，去查询对应的子城市的信息
                initProvinceOrCity(pid, 'sCity');

                //3.绑定数据，把数据绑定到sCity下拉菜单中(绑定之前要清空原来的内容)
            };

            //2.加载默认选中省份对应的城市信息
        };

        //pid表示，要根据pid这个父id来加载对应的所有子城市
        //elementId表示加载城市还是省。将来获取到的数据要加载到哪个select标签下。
        function initProvinceOrCity(pid, elementId) {
            //发起异步请求
            var xhr = null;
            if (typeof XMLHttpRequest != 'undefined') {
                xhr = new XMLHttpRequest();
            } else {
                xhr = new ActiveXObject("Microsoft.XMLHttp");
            }

            //回调函数
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    //把获取的json格式字符串，转换为json对象（"数组"对象）
                    var json_data = JSON.parse(xhr.responseText);

                    //获取从服务器端返回的默认要选中的城市的Id
                    var selected_id = json_data.SelectedId; //默认获取的Id是10.

                    //获取具体的地区信息的json对象。
                    var jsonArea = json_data.AreaJsonData;
                    //获得省份/市的select标签
                    var s1 = document.getElementById(elementId);
                    //通过索引，遍历每个对象
                    for (var i = 0; i < jsonArea.length; i++) {
                        //创建一个option标签
                        var opt = document.createElement('option');
                        opt.value = jsonArea[i].AreaId;

                        //如果当前加载的不是城市信息（那么就是“省份信息”）的时候再设置默认选中项。
                        if (elementId != 'sCity') {
                            if (selected_id == jsonArea[i].AreaId) {
                                opt.selected = true;
                                //当获得某个向备选中后，立刻加载对应的城市信息
                                initProvinceOrCity(selected_id, 'sCity');
                            }//2013年8月5日15:43:40
                        }
                        opt.innerHTML = jsonArea[i].AreaName;
                        s1.appendChild(opt);
                    }
                    //                    //当省份都加载完毕后再加载城市列表
                    //                    if (elementId != 'sCity') {
                    //                        //根据当前默认被选中的省份加载对应的城市信息
                    //                        initProvinceOrCity(selected_id, 'sCity');
                    //                    }
                }
            };
            xhr.open('get', 'GetAreaByParentId.ashx?pid=' + pid, true);
            xhr.send(null);

        }

    </script>
</head>
<body>
    省：<select id="sProvince"></select>
    市：<select id="sCity"></select>
</body>
</html>
