<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="../scripts/jquery-1.8.2.js" type="text/javascript"></script>
    <script src="../scripts/json2.js" type="text/javascript"></script>
    <script src="../scripts/datapattern2.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            $('#btn').click(function () {
                //1加载表格数据与分页导航
                initData(1);
            });
        });

        function initData(pageindex) {

            loadDataToTable(pageindex);
        }



        function loadDataToTable(pageindex) {
            $.getJSON('datalist.ashx?pageindex=' + pageindex, null, function (_data) {
                //alert(_data); //返回的是json对象
                var tbodyJqueryObj = $('#tblList tbody');
                //清空表格 
                tbodyJqueryObj.empty();
                //1.加载表格中的数据
                for (var i = 0; i < _data.PageDataList.length; i++) {
                    //创建行
                    $('<tr><td>' + _data.PageDataList[i].StuId + '</td><td>' + _data.PageDataList[i].StuName + '</td><td>' + _data.PageDataList[i].StuAge + '</td><td>' + _data.PageDataList[i].StuGender + '</td><td>' + _data.PageDataList[i].StuEmail + '</td><td>' + (eval(_data.PageDataList[i].StuBirthday.replace(/\/Date\((\d+)\)\//gi, "new Date($1)"))).pattern("yyyy-M-d h:m:s.S") + '</td><td><a href="javascript:void(0);">编辑</a></td><td><a href="javascript:void(0);">删除</a></td></tr>').appendTo(tbodyJqueryObj);
                }

                //2.加载导航数据
                document.getElementById('pnavi').innerHTML = _data.Navigator;


                //3.初始化导航栏的事件
                $('#pnavi a').click(function () {
                    var pageindex = $(this).attr('href').substring($(this).attr('href').lastIndexOf('=') + 1);
                    initData(pageindex);
                    return false;
                });

            });
        }
    </script>
</head>
<body>
    <!--stuId, stuName, stuAge, stuGender, stuEmail, stuBirthday-->
    <input type="button" name="name" value="load data" id="btn" />
    <table id="tblList" border="1" cellpadding="2" cellspacing="2">
        <thead>
            <tr>
                <td>
                    编号
                </td>
                <td>
                    姓名
                </td>
                <td>
                    年龄
                </td>
                <td>
                    性别
                </td>
                <td>
                    邮箱
                </td>
                <td>
                    生日
                </td>
                <td>
                    编辑
                </td>
                <td>
                    删除
                </td>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <p id="pnavi">
    </p>
</body>
</html>
