<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="../scripts/json2.js" type="text/javascript"></script>
    <script src="../scripts/datapattern2.js" type="text/javascript"></script>
    <script type="text/javascript">
        window.onload = function () {

            document.getElementById('btn').onclick = function () {
                //异步加载数据并填充
                initData(1);
            };
        };

        function initPageEvents() {
            //获取所有分页超链接为超链接绑定事件
            var aLinks = document.getElementById('pnavi').getElementsByTagName('a');
            for (var i = 0; i < aLinks.length; i++) {
                aLinks[i].onclick = function () {
                    //1.获取href的地址
                    //alert(this.href);
                    initData(this.href.substring(this.href.lastIndexOf('=') + 1));
                    //2.通过该地址发起异步请求
                    return false;
                };
            }

        }

        //初始化数据
        function initData(pindex) {
            var xhr = null;
            if (typeof (XMLHttpRequest) != 'undefined') {
                xhr = new XMLHttpRequest();
            } else {
                xhr = new ActiveXObject("Microsoft.XMLHttp");
            }
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {

                    //===================绑定表格数据============================
                    var _studentList = JSON.parse(xhr.responseText).PageDataList;
                    //获取表格对象
                    var tblObj = document.getElementById('tblList').getElementsByTagName('tbody')[0];

                    //清除原有数据
                    while (tblObj.firstChild) {
                        tblObj.removeChild(tblObj.firstChild);
                    }

                    //遍历_studentList，并填充表格
                    for (var i = 0; i < _studentList.length; i++) {
                        var trObj = tblObj.insertRow(-1);
                        trObj.insertCell(-1).innerHTML = _studentList[i].StuId;
                        trObj.insertCell(-1).innerHTML = _studentList[i].StuName;
                        trObj.insertCell(-1).innerHTML = _studentList[i].StuAge;
                        trObj.insertCell(-1).innerHTML = _studentList[i].StuGender;
                        trObj.insertCell(-1).innerHTML = _studentList[i].StuEmail;
                        ///Date(1111)/
                        trObj.insertCell(-1).innerHTML = new Date(Number(_studentList[i].StuBirthday.replace(/\/Date\((\d+)\)\//gi, '$1'))).pattern('yyyy-MM-dd hh:mm:ss');
                    }

                    //================================绑定导航数据===========================
                    var naviStr = JSON.parse(xhr.responseText).Navigator;
                    document.getElementById('pnavi').innerHTML = naviStr;

                    //初始化分页事件
                    initPageEvents();
                }
            };
            xhr.open("get", "datalist.ashx?pageindex=" + pindex, true);
            xhr.send(null);
        }
    </script>
</head>
<body>
    <!--stuId, stuName, stuAge, stuGender, stuEmail, stuBirthday-->
    <input type="button" name="name" value="load data" id="btn" />
    <table id="tblList" border="1" cellpadding="2" cellspacing="2">
        <thead>
            <tr>
                <td>
                    编号
                </td>
                <td>
                    姓名
                </td>
                <td>
                    年龄
                </td>
                <td>
                    性别
                </td>
                <td>
                    邮箱
                </td>
                <td>
                    生日
                </td>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <p id="pnavi">
    </p>
</body>
</html>
