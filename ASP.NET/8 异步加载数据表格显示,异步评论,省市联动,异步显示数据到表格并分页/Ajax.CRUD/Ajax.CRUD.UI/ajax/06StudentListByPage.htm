<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="../scripts/datapattern2.js" type="text/javascript"></script>
    <script src="../scripts/jquery-1.8.2.js" type="text/javascript"></script>
    <script src="../scripts/json2.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {
            //异步加载数据
            initStudents(1);
        });


        //根据用户要查看第几页，异步发起请求
        function initStudents(pageindex) {
            //加载数据之前清空tbody中的内容
            $.getJSON('GetStudentsByPage.ashx', { 'pageindex': pageindex }, function (_jsondata) {
                //测试回调能否正常获取数据
                //alert(JSON.stringify(_jsondata));
                $('#tblStudent tbody').empty();
                //1.把对应的数据添加到表格中
                //遍历查询到的每条学生记录，
                for (var i = 0; i < _jsondata.StudentList.length; i++) {
                    //创建一行，并添加到tbody中
                    $('<tr><td>' + _jsondata.StudentList[i].StuId + '</td><td>' + _jsondata.StudentList[i].StuName + '</td><td>' + _jsondata.StudentList[i].StuAge + '</td><td>' + _jsondata.StudentList[i].StuGender + '</td><td>' + _jsondata.StudentList[i].StuEmail + '</td><td>' + (eval(_jsondata.StudentList[i].StuBirthday.replace(/\/Date\((\d+)\)\//gi, "new Date($1)"))).pattern("yyyy-M-d") + '</td></tr>').appendTo('#tblStudent tbody');
                }
                //2.把导航字符串添加到pnav中
                document.getElementById('pnav').innerHTML = _jsondata.NavigatorString;


                //3.//为导航实现异步操作:原理：为每个导航的超链接标签注册一个onclick事件，在该事件中调用异步函数进行请求。 
                initNavigatorEvents();
            });
        }

        function initNavigatorEvents() {
            //1.获取所有导航，超链接，并为每个超链接注册单击事件
            $('#pnav a').click(function () {
                //initStudents(??);
                var url = this.href;
                var pindex = url.substring(url.lastIndexOf('=') + 1);
                initStudents(pindex);
                return false;
            });
        }
    </script>
</head>
<body>
    <table id="tblStudent" border="1" cellpadding="2" cellspacing="2">
        <thead>
            <tr>
                <th>
                    学生编号
                </th>
                <th>
                    学生姓名
                </th>
                <th>
                    学生年龄
                </th>
                <th>
                    学生性别
                </th>
                <th>
                    学生Email
                </th>
                <th>
                    学生生日
                </th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <p id="pnav">
    </p>
</body>
</html>
