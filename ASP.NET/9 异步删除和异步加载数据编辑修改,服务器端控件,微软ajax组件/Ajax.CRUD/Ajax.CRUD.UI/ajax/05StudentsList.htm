<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
    <script src="../scripts/jquery-1.8.2.js" type="text/javascript"></script>
    <script src="../scripts/json2.js" type="text/javascript"></script>
    <script src="../scripts/datapattern2.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(function () {

            $('#btn').click(function () {
                //1.调用方法发起异步请求，将拿到的数据动态执行js加载到table中。
                loadStudents();
            });
        });

        function loadStudents() {
            //发起异步请求，获取请求到的json数据
            $.getJSON('GetAllStudents.ashx', null, function (_data) {
                //document.getElementById('dv1').innerHTML = JSON.stringify(_data);
                //遍历json中的每个对象，每遍历一个对象，创建一个tr对象，并加到表格中。
                for (var i = 0; i < _data.length; i++) {

                    //     /Date(303148800000)/
                    //    /\/Date\((\d+)\)\//
                    //字符串提取，从/Date(303148800000)/中提取字符串303148800000
                    var date = _data[i].StuBirthday.replace(/\/Date\((\d+)\)\//gi, '$1')
                    //把字符串303148800000，转换为数字303148800000
                    var number = Number(date);
                    //根据数字303148800000,创建一个日期对象
                    var date = new Date(number);
                    //var dateStr = new Date(number).toLocaleDateString() + new Date(number).toLocaleTimeString();
                    var dateStr = date.pattern('yyyy-MM-dd HH:mm:ss');
                    //创建一个行
                    $('<tr><td>' + _data[i].StuId + '</td><td>' + _data[i].StuName + '</td><td>' + _data[i].StuAge + '</td><td>' + _data[i].StuGender + '</td><td>' + _data[i].StuEmail + '</td><td>' + dateStr + '</td></tr>').appendTo('#tblStudent tbody');
                }
            });
        }
    </script>
</head>
<body>
    <input type="button" name="name" value="get data" id="btn" />
    <div id="dv1" style="border: 1px solid blue;">
    </div>
    <table id="tblStudent" border="1" cellpadding="2" cellspacing="2">
        <thead>
            <tr>
                <th>
                    学生编号
                </th>
                <th>
                    学生姓名
                </th>
                <th>
                    学生年龄
                </th>
                <th>
                    学生性别
                </th>
                <th>
                    学生Email
                </th>
                <th>
                    学生生日
                </th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
</body>
</html>
